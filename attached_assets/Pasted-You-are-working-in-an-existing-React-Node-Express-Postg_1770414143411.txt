You are working in an existing React + Node/Express + Postgres (Drizzle) site with:
- Admin CMS (block library + page builder)
- Public CMS renderer with block registry
- Theme tokens already applied
- A “premium components” UI layer (Section/CardPro/ButtonPro/ImageFloat, etc.)

CRITICAL RULES:
- NON-DESTRUCTIVE changes only.
- Do not remove or break existing blocks, pages, routes, or APIs.
- Add new block types and extend existing components safely.
- Use existing styling/tokens and respect prefers-reduced-motion.

GOAL:
1) Add tasteful service icons using lucide-react (consistent sizing, stroke, and style).
2) Add a new CMS block: “Before/After Gallery” (with optional slider compare + simple grid fallback).
3) Add Admin UI support for editing this block (schema + inspector controls).
4) Add optional project gallery integration using existing media library URLs (no required upload changes).

------------------------------------------------------------
PHASE 1 — INSTALL + ICON SYSTEM
------------------------------------------------------------

1) Add dependency (if not present):
- lucide-react

2) Create a single icon mapping helper:
frontend/src/ui/icons/serviceIcons.(ts|js)
- Export a function getServiceIcon(nameOrKey) that returns a lucide icon component.
- Keep icons consistent:
  - size: 20–24px for cards, 28–32px for hero/featured
  - strokeWidth: 1.75 (or existing default)
- Provide mappings (use these keys and icons):
  - land-clearing -> Trees
  - brush-removal -> Scissors (or Shrub if available; otherwise Leaf)
  - forestry-mulching -> Axe
  - lot-clearing -> Mountain
  - stump-grinding -> Drill
  - driveway-trail-cutting -> Route
  - storm-cleanup -> CloudLightning
  - pricing/value -> BadgeDollarSign
  - fast-quote -> MessageSquareText
If any icon name doesn’t exist in lucide-react, choose the closest available and document the substitution.

3) Update the UI components used by service cards and “What We Clear” cards:
- Add an optional icon prop
- Render icon in a soft circular background using theme tokens
- Ensure icons don’t overpower content; keep subtle.

------------------------------------------------------------
PHASE 2 — UPDATE SERVICE BLOCKS TO USE ICONS
------------------------------------------------------------

Update these blocks/components (without breaking existing props):
- service_cards block
- feature_grid block (if used for “What We Clear”)
- any services overview card components

Rules:
- If a service item has a key/slug, use getServiceIcon(key).
- If not, attempt to derive from title text.
- Provide fallback icon: Sparkles.

Add a small “trust row” icon set under hero (optional if already exists):
- Local service, insured, pro equipment, fast quotes
Use lucide icons subtly.

------------------------------------------------------------
PHASE 3 — NEW CMS BLOCK: BEFORE/AFTER GALLERY
------------------------------------------------------------

A) DATABASE / CMS BLOCK LIBRARY SEED (NO NEW TABLES)
Seed a new system block into cms_block_library (upsert, never delete user blocks):
key: before_after_gallery
name: Before/After Gallery
category: Media
description: Show project transformations with before/after images (slider compare + grid fallback).
defaultProps:
{
  "headline": "Before & After: Real Results",
  "subheadline": "See how BrushWhackers transforms overgrown land into clean, usable space.",
  "layout": "compare",  // compare | grid
  "items": [
    {
      "id": "<uuid/nanoid>",
      "title": "Brush Removal & Mulching",
      "location": "Matthews, NC",
      "beforeImageUrl": "<stock or media url>",
      "beforeAlt": "Overgrown brush and saplings before clearing",
      "afterImageUrl": "<stock or media url>",
      "afterAlt": "Clean cleared area after brush removal and mulching"
    },
    {
      "id": "<uuid/nanoid>",
      "title": "Lot Clearing",
      "location": "Concord, NC",
      "beforeImageUrl": "<stock or media url>",
      "beforeAlt": "Dense undergrowth covering a lot before clearing",
      "afterImageUrl": "<stock or media url>",
      "afterAlt": "Lot cleared and opened up after work"
    }
  ],
  "ctaText": "Get a Fast Quote",
  "ctaHref": "/quote"
}

schema:
- headline: text (required)
- subheadline: textarea
- layout: select [compare, grid]
- items: array editor with fields:
  - title (text)
  - location (text)
  - beforeImageUrl (image picker / url)
  - beforeAlt (text required)
  - afterImageUrl (image picker / url)
  - afterAlt (text required)
- ctaText, ctaHref

B) FRONTEND RENDERER
Add block component:
frontend/src/cms/blocks/BeforeAfterGalleryBlock.(tsx|jsx)

Design requirements:
- Use Section + SectionHeaderPro + CardPro + ImageFloat
- Two layout modes:
  1) compare:
     - For each item, show a “before/after compare” slider component
  2) grid:
     - Show before and after as two images in a responsive grid with labels

Compare slider options:
- Prefer a lightweight implementation without large libs:
  - Make a simple CSS+pointer slider:
    - container relative
    - after image on top with width controlled by slider percentage
    - draggable handle sets percentage
- Must support mouse + touch
- Respect prefers-reduced-motion (no animated transitions)
- Show labels “Before” and “After”
- Ensure alt text is used correctly

C) ADMIN INSPECTOR SUPPORT
Extend the block settings UI to support:
- array editor for items (add/remove/reorder)
- media picker integration for before/after images (reuse existing media modal)
- required field warnings for missing alt text / missing images

D) ADD TO BLOCK REGISTRY
Add before_after_gallery to registry mapping so it renders on public pages.

------------------------------------------------------------
PHASE 4 — OPTIONAL “PROJECTS” BRIDGE (IF PROJECT TABLE EXISTS)
------------------------------------------------------------

If a crm_projects table exists:
- Add a toggle in the block settings:
  - “Auto-populate from published projects” (true/false)
- If true:
  - Fetch /api/public/projects (new endpoint) returning published projects with before/after images
  - Use them as items (limit 6)
If crm_projects does not exist yet, skip this phase entirely.

------------------------------------------------------------
PHASE 5 — CMS DIAGNOSTICS UPDATES
------------------------------------------------------------

Update /admin/cms/diagnostics checks:
- Confirm before_after_gallery exists in cms_block_library
- Confirm renderer registry includes before_after_gallery
- Confirm items have required alt text and URLs

------------------------------------------------------------
END-OF-PROMPT REQUIREMENT — DOCS UPDATE (MANDATORY, CATEGORIZED)
------------------------------------------------------------

Update Admin → Docs with thorough technical entries:

Category: CMS
- “Before/After Gallery Block”
  - props contract
  - schema fields
  - admin inspector behavior
  - rendering modes (compare vs grid)
  - accessibility requirements (alt text)
  - prefers-reduced-motion behavior

Category: Theming
- “Lucide Icon System”
  - icon mapping file
  - sizing/stroke rules
  - fallback behavior

Category: Media
- “Before/After Media Selection”
  - how media picker feeds image fields
  - recommended image dimensions and file types

Category: Performance
- “Compare Slider Performance Notes”
  - no heavy libraries
  - event handling approach
  - touch/mouse support

Category: APIs
- If you add /api/public/projects, document it here; otherwise document “No API changes”.

Include request/response examples for any new endpoints, and list all new/updated files.

FINAL CHECKS:
- Service cards display icons cleanly
- before_after_gallery block can be added from library and edited
- Compare slider works on mouse + touch
- Grid layout works on mobile
- Required alt text validation warnings appear in admin
- Docs updated and categorized
