You are working inside an existing full-stack React + Node/Express + Postgres (Drizzle) project that already has an Admin area. This prompt is focused ONLY on the Admin panel + CMS system.

CRITICAL RULES (NON-DESTRUCTIVE):
- DO NOT delete, rename, or rewrite existing working files.
- Prefer creating NEW files and NEW routes.
- If you must modify an existing file, make the smallest safe change and comment it.
- Keep all current public site behavior intact.

GOAL:
Build a modern Admin CMS toolset with:
1) Reusable “Section Blocks” (content blocks) library
2) Drag-and-drop Page Builder (block-based)
3) Advanced SEO settings per page/post (incl. OpenGraph/Twitter + JSON-LD)
4) Page template creator/manager (templates composed of blocks)
5) A clean “CMS Tools Library” that is easy for non-technical admins
6) Up to 10 pre-designed Theme Presets (quickly change look/feel site-wide)
7) All stored in Postgres using Drizzle ORM
8) All admin CMS features documented in the Admin Docs Library at the end

PREFERRED HIGH-QUALITY LIBRARIES (use if compatible with repo):
- Drag & drop: @dnd-kit/core, @dnd-kit/sortable
- Editor for rich text blocks: @tiptap/react + starter-kit (or existing editor if already in repo)
- Forms: react-hook-form + zod resolver
- Data fetching: @tanstack/react-query (if not already present; otherwise use existing fetch pattern)
- Validation: zod
- UI: use existing component system; if none, keep minimal Tailwind/CSS but make UI clean and consistent

If the repo already has alternatives (e.g., Slate, Zustand, Redux, etc.), integrate with what exists rather than adding duplicates.

------------------------------------------------------------
PHASE A — DATABASE (DRIZZLE SCHEMA) FOR CMS + THEMES
------------------------------------------------------------

1) Create/extend Drizzle schema in /server/db/schema.(ts|js) (non-destructive: append new tables).
Add these tables:

A) cms_pages
- id uuid pk default random
- createdAt timestamp default now not null
- updatedAt timestamp default now not null
- status text not null default 'draft'  (draft|published)
- slug text not null unique
- title text not null
- description text
- pageType text not null default 'page' (page|service|landing)
- templateId uuid nullable references cms_templates.id
- blocks jsonb not null default '[]'  (array of block instances)
- seo jsonb not null default '{}'     (SEO object)
- publishedAt timestamp nullable

Indexes:
- unique index slug
- index status
- index publishedAt

B) cms_templates
- id uuid pk default random
- createdAt, updatedAt
- name text not null unique
- description text
- blocks jsonb not null default '[]'  (block instances used as template starting point)
- seoDefaults jsonb not null default '{}' (optional)
- status text not null default 'active'

C) cms_block_library
(This is the reusable block catalog – definitions and default props)
- id uuid pk default random
- createdAt, updatedAt
- key text not null unique   (e.g., "hero", "cta_band", "service_grid")
- name text not null
- category text not null     (e.g., "Layout", "Marketing", "Media", "Social Proof", "Forms")
- icon text                  (string key for an icon)
- description text
- defaultProps jsonb not null default '{}' (default content/settings)
- schema jsonb not null default '{}'       (config schema used to render block settings UI)
- isSystem boolean not null default true   (system blocks vs user blocks)

D) cms_media
- id uuid pk default random
- createdAt, updatedAt
- url text not null
- alt text
- title text
- width int
- height int
- mimeType text
- sizeBytes int
- tags jsonb not null default '[]'

E) theme_presets
- id uuid pk default random
- createdAt, updatedAt
- key text not null unique        (e.g., "blue-steel", "forest-pro", etc.)
- name text not null
- description text
- tokens jsonb not null           (design tokens)
- isSystem boolean not null default true
- isActive boolean not null default false

F) cms_redirects (for SEO-friendly slug changes)
- id uuid pk default random
- createdAt timestamp default now not null
- fromPath text not null unique
- toPath text not null
- code int not null default 301

2) Add a migration via drizzle-kit and ensure migrations are created in /server/db/migrations.
Do not break existing migrations.

------------------------------------------------------------
PHASE B — DEFINE “BLOCK INSTANCE” SHAPE (APP CONTRACT)
------------------------------------------------------------

Implement a single shared TypeScript type (or JSDoc) used by both admin + renderer:

BlockInstance:
{
  "id": "uuid or nanoid",
  "type": "string (matches cms_block_library.key)",
  "props": { ...block-specific content/settings... },
  "style": { ...optional per-block style overrides... },
  "meta": { "label": "optional human label", "hidden": false }
}

Create a shared file:
- /shared/cms/types.(ts|js)
and ensure it can be imported from server + client (or duplicate minimal types if monorepo boundaries require).

------------------------------------------------------------
PHASE C — ADMIN CMS UI (DRAG & DROP PAGE BUILDER)
------------------------------------------------------------

Add Admin routes/pages (create new pages; do not remove existing):
- /admin/cms  (CMS home / tool library)
- /admin/cms/pages
- /admin/cms/pages/new
- /admin/cms/pages/:id (Page Builder)
- /admin/cms/templates
- /admin/cms/templates/new
- /admin/cms/templates/:id (Template Builder)
- /admin/cms/blocks (Block Library viewer)
- /admin/cms/media (Media library)
- /admin/cms/themes (Theme presets selector + preview)
- /admin/cms/redirects (Redirect manager)

CMS HOME (“library of tools”) REQUIREMENTS:
- A simple grid of cards:
  - Pages
  - Templates
  - Block Library
  - Media Library
  - Themes
  - Redirects
  - SEO Guide (mini help panel)
Each card has: 1-sentence description + primary button.

PAGES LIST (/admin/cms/pages):
- Table with: Title, Slug, Status, Updated, PublishedAt, Actions
- Actions: Edit, Duplicate, Publish/Unpublish, Preview, Delete (soft-delete if you implement)
- Filter: Status (draft/published), PageType
- Search: title/slug

PAGE BUILDER (/admin/cms/pages/:id):
- 3-panel layout:
  Left: Block Library (search + categories + draggable items)
  Center: Page Canvas (sortable block list + live preview)
  Right: Inspector Tabs:
    - Block Settings (dynamic form based on block schema)
    - Page Settings
    - SEO (advanced)
    - Publish

Drag & Drop:
- Use @dnd-kit/sortable for block ordering
- Support:
  - Add block from library to canvas
  - Reorder blocks
  - Duplicate block
  - Remove block (confirm)
  - Collapse block
  - Rename block label (meta.label)

BLOCK SETTINGS UI:
- Render dynamic controls from cms_block_library.schema (JSON schema-like):
  - text, textarea, richtext, image, select, multiselect, toggle, number, color, link
- Save updates to the block instance props in local state, then persist to server.

ADVANCED SEO TAB (per page):
Store in cms_pages.seo JSON:
{
  "title": "...",
  "description": "...",
  "canonicalUrl": "...",
  "robots": "index,follow|noindex,follow|noindex,nofollow",
  "og": { "title": "...", "description": "...", "image": "...", "type": "website", "locale": "en_US" },
  "twitter": { "card": "summary_large_image", "title": "...", "description": "...", "image": "..." },
  "schema": {
     "enabled": true,
     "type": "LocalBusiness|Service|FAQPage|Article",
     "jsonLd": "{...stringified json...}"
  },
  "sitemap": { "priority": 0.7, "changefreq": "weekly" }
}

SEO UX:
- Show a “Google snippet preview”
- Validate JSON-LD field (must be valid JSON)
- Provide quick presets:
  - Default LocalBusiness
  - Service page schema
  - FAQPage schema
- Add “Auto-generate from page content” button (simple heuristic; do NOT call external APIs)

TEMPLATES:
Templates are the same builder as pages, but stored in cms_templates.
Allow “Create page from template”.

THEME PRESETS:
- Create 10 system presets in theme_presets table (seed script / migration-safe seed).
- Each preset includes tokens JSON:
{
 "name": "Blue Steel",
 "colors": { "primary": "#1E5BFF", "secondary": "#0F172A", "accent": "#22C55E", "bg": "#0B1220", "surface": "#111C33", "text": "#E5E7EB" },
 "font": { "family": "Inter", "headingsWeight": 700, "bodyWeight": 400 },
 "radius": { "card": 16, "button": 14 },
 "shadow": { "card": "soft", "button": "soft" },
 "components": { "buttonStyle": "solid|outline|soft", "navStyle": "transparent|solid" }
}

Add a clean /admin/cms/themes page:
- List presets with preview tiles
- “Activate” button sets isActive = true and unsets others
- Show a live preview panel using the tokens

IMPORTANT:
Do not break existing public styling. For now, just store the active preset and expose it via a public settings endpoint in the next phase, or if a settings endpoint already exists, extend it safely.

MEDIA LIBRARY:
- Start simple: allow storing external image URLs + alt text in cms_media.
- UI:
  - Add media modal
  - Search/filter by tags
- If the project already supports file uploads, integrate; otherwise do not implement uploads yet.

REDIRECT MANAGER:
- UI to create 301 redirects
- Add a backend middleware that checks incoming requests against cms_redirects and redirects accordingly (server-side). Implement carefully so it doesn’t interfere with API routes.

------------------------------------------------------------
PHASE D — BACKEND APIs (ADMIN PROTECTED)
------------------------------------------------------------

Create protected admin endpoints (use existing auth; if none exists, keep endpoints behind a simple temporary admin guard used elsewhere in the repo):

/api/admin/cms/pages
- GET list (pagination, filters)
- POST create

/api/admin/cms/pages/:id
- GET one
- PATCH update (title, slug, status, blocks, seo, templateId)
- DELETE soft delete (or hard delete if repo conventions require)

/api/admin/cms/templates
- GET list
- POST create

/api/admin/cms/templates/:id
- GET one
- PATCH update
- DELETE

/api/admin/cms/blocks
- GET list
- POST create custom block (isSystem=false)

/api/admin/cms/media
- GET list
- POST create

/api/admin/cms/themes
- GET list
- POST activate (or PATCH /:id)

/api/admin/cms/redirects
- GET list
- POST create
- DELETE :id

Use zod validation on request bodies. Use Drizzle queries for all DB access.

------------------------------------------------------------
PHASE E — PUBLIC RENDERING CONTRACT (DON’T FULLY IMPLEMENT YET)
------------------------------------------------------------

Add (non-breaking) public endpoints that will later render CMS pages:
- GET /api/public/pages/:slug  -> returns published cms_page with blocks + seo + templateId
- GET /api/public/theme        -> returns active theme preset tokens
- GET /api/public/redirects    -> optional; redirects primarily server middleware

Do not change the public routes yet unless the repo already supports dynamic rendering. Just ensure APIs exist.

------------------------------------------------------------
PHASE F — INITIAL SYSTEM BLOCK LIBRARY (SEED)
------------------------------------------------------------

Seed cms_block_library with at least these block types (system blocks):
1) hero
2) rich_text
3) image_banner
4) feature_grid
5) service_cards
6) testimonial_row
7) cta_band
8) faq
9) pricing_table
10) contact_cta

For each, define:
- defaultProps (reasonable defaults)
- schema for the inspector form

Example hero props:
{ "headline": "...", "subheadline": "...", "primaryCtaText": "Get a Fast Quote", "primaryCtaHref": "/quote", "imageUrl": "...", "imageAlt": "Skid steer forestry mulcher clearing brush" }

------------------------------------------------------------
END-OF-PROMPT REQUIREMENT — DOCS LIBRARY UPDATE (MANDATORY)
------------------------------------------------------------

Update the Admin Docs Library (the existing /admin/docs system) to include a new section:

“Phase X: Admin CMS + Page Builder”

Document:
- All new Admin routes/pages
- All new API endpoints (method/path) with brief request/response examples
- All new DB tables and their purpose
- BlockInstance contract shape
- How drag-and-drop works (dnd-kit)
- How SEO settings are stored and validated (including JSON-LD)
- Theme preset system and how activation works
- Redirect manager and server middleware behavior
- Any new dependencies added

FINAL CHECKS:
- Admin CMS pages load without runtime errors
- Creating a page works (stored in Postgres)
- Page builder can add/reorder/remove blocks and persists them
- SEO tab saves
- Theme presets exist and can be activated
- Docs Library reflects everything above
